# Playbook: Устранение уязвимости CVE-2021-41773

## Описание уязвимости
CVE-2021-41773 — это уязвимость в Apache HTTP Server 2.4.49 и 2.4.50, которая позволяет злоумышленникам:
- Получать доступ к файлам за пределами корневого каталога веб-сервера.
- Выполнять произвольный код в определённых конфигурациях.

## Шаги устранения уязвимости

### 1. Определение уязвимости

1. Проверьте текущую версию Apache:
   ```bash
   apache2 -v
   ```
   Если версия — 2.4.49 или 2.4.50, сервер подвержен уязвимости.

2. Проверьте конфигурацию веб-сервера:
   ```bash
   sudo nano /etc/apache2/apache2.conf
   ```
   Убедитесь, что в конфигурации используются ограничения доступа, такие как `Require all denied` для защиты каталогов.

---

### 2. Обновление Apache HTTP Server

1. Обновите список пакетов:
   ```bash
   sudo apt update
   ```

2. Установите обновлённую версию Apache (2.4.51 или выше):
   ```bash
   sudo apt install --only-upgrade apache2
   ```

3. Убедитесь, что обновление прошло успешно:
   ```bash
   apache2 -v
   ```

---

### 3. Проверка и исправление конфигурации

1. Откройте основной файл конфигурации Apache:
   ```bash
   sudo nano /etc/apache2/apache2.conf
   ```

2. Убедитесь, что конфигурация защищает критические каталоги:
   ```
   <Directory />
       Require all denied
   </Directory>
   ```

3. Убедитесь, что каталог `/var/www/html` настроен с корректными разрешениями:
   ```
   <Directory /var/www/html>
       Options Indexes FollowSymLinks
       AllowOverride None
       Require all granted
   </Directory>
   ```

---

### 4. Перезапуск Apache

После внесения изменений перезапустите службу Apache:
```bash
sudo systemctl restart apache2
```

---

### 5. Проверка уязвимости

1. Используйте сканеры уязвимостей, такие как `nmap` или специализированные инструменты, чтобы проверить исправление:
   ```bash
   сurl --silent --path-as-is --insecure "http://<host>/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd" | grep -q "root.*" && echo "Host is vulnerable" || echo "Host is Not vulnerable"
   ```

2. Убедитесь, что сервер больше не уязвим к эксплуатации.

---

## Рекомендации по предотвращению подобных инцидентов

1. Регулярно обновляйте серверные компоненты.
2. Минимизируйте количество активных модулей и используемых функций.
3. Включите логирование и мониторинг активности веб-сервера.
4. Настройте брандмауэр и ограничения доступа к файлам.
5. Проводите регулярный аудит конфигурации и безопасности системы.
